<pre xmlns="http://www.w3.org/1999/xhtml">
<span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">stylesheet</span> <span class="nxml-namespace-attribute-xmlns">xmlns</span><span class="nxml-namespace-attribute-colon">:</span><span class="nxml-namespace-attribute-prefix">xsl</span>=<span class="nxml-namespace-attribute-value-delimiter">"</span><span class="nxml-namespace-attribute-value">http://www.w3.org/1999/XSL/Transform</span><span class="nxml-namespace-attribute-value-delimiter">"</span>
                <span class="nxml-namespace-attribute-xmlns">xmlns</span><span class="nxml-namespace-attribute-colon">:</span><span class="nxml-namespace-attribute-prefix">xs</span>=<span class="nxml-namespace-attribute-value-delimiter">"</span><span class="nxml-namespace-attribute-value">http://www.w3.org/2001/XMLSchema</span><span class="nxml-namespace-attribute-value-delimiter">"</span>
                <span class="nxml-namespace-attribute-xmlns">xmlns</span><span class="nxml-namespace-attribute-colon">:</span><span class="nxml-namespace-attribute-prefix">http</span>=<span class="nxml-namespace-attribute-value-delimiter">"</span><span class="nxml-namespace-attribute-value">http://www.expath.org/mod/http-client</span><span class="nxml-namespace-attribute-value-delimiter">"</span>
                <span class="nxml-namespace-attribute-xmlns">xmlns</span><span class="nxml-namespace-attribute-colon">:</span><span class="nxml-namespace-attribute-prefix">http-java</span>=<span class="nxml-namespace-attribute-value-delimiter">"</span><span class="nxml-namespace-attribute-value">java:org.expath.saxon.HttpClient</span><span class="nxml-namespace-attribute-value-delimiter">"</span>
                <span class="nxml-namespace-attribute-xmlns">xmlns</span><span class="nxml-namespace-attribute-colon">:</span><span class="nxml-namespace-attribute-prefix">goog</span>=<span class="nxml-namespace-attribute-value-delimiter">"</span><span class="nxml-namespace-attribute-value">http://www.fgeorges.org/ns/xslt/google</span><span class="nxml-namespace-attribute-value-delimiter">"</span>
                <span class="nxml-attribute-local-name">exclude-result-prefixes</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">#all</span><span class="nxml-attribute-value-delimiter">"</span>
                <span class="nxml-attribute-local-name">version</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">2.0</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>

   <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content">
       Google information about authentication and contacts API:
       http://code.google.com/apis/accounts/docs/AuthForInstalledApps.html
       http://code.google.com/apis/contacts/developers_guide_protocol.html
   </span><span class="nxml-comment-delimiter">--&gt;</span>

   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">output</span> <span class="nxml-attribute-local-name">indent</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">yes</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>

   <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> The account to use (the address email) </span><span class="nxml-comment-delimiter">--&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">account</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">required</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">yes</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
   <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> The associated password, required </span><span class="nxml-comment-delimiter">--&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">pwd</span><span class="nxml-attribute-value-delimiter">"</span>     <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">required</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">yes</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>

   <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content">
       Utility: check for error in HTTP response.
   </span><span class="nxml-comment-delimiter">--&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">function</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">goog:check-error</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the HTTP response element </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">response</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">element(http:response)</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> message in case of error </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">message</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">variable</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">status</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:integer($response/@status)</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">if</span> <span class="nxml-attribute-local-name">test</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">not($status ge 200 or $status le 299)</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
         <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">sequence</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">
             error((), concat($message, ': ', $response/@message))</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">if</span><span class="nxml-tag-delimiter">&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">function</span><span class="nxml-tag-delimiter">&gt;</span>

   <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content">
       The authentication parameters, as simple param elements.
   </span><span class="nxml-comment-delimiter">--&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">function</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">goog:auth-params</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">element(param)+</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the email (user account) </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">email</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the password </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">pwd</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> $email can be abbreviated if @gmail.com </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">variable</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">full-email</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">
          if ( contains($email, '@') ) then
            $email
          else
            concat($email, '@gmail.com')</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the param elements </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">Email</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
         <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">value-of</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">$full-email</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-local-name">param</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">Passwd</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
         <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">value-of</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">$pwd</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-local-name">param</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">source</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span><span class="nxml-text">fgeorges.org-contacts-1</span><span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-local-name">param</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">service</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span><span class="nxml-text">cp</span><span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-local-name">param</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">accountType</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
         <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">value-of</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">
             if ( ends-with($full-email, '@gmail.com') ) then
               'GOOGLE'
             else
               'HOSTED_OR_GOOGLE'</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-local-name">param</span><span class="nxml-tag-delimiter">&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">function</span><span class="nxml-tag-delimiter">&gt;</span>

   <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content">
       Authenticates to the Google server, and returns the
       authentication token.
   </span><span class="nxml-comment-delimiter">--&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">function</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">goog:auth-token</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the email (user account) </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">email</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the password </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">pwd</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the endpoint </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">variable</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">endpoint</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">
          'https://www.google.com/accounts/ClientLogin'</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the http request element </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">variable</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">request</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">element()</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
         <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">http</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">request</span> <span class="nxml-attribute-local-name">method</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">post</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">href</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">{ $endpoint }</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
            <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">http</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">body</span> <span class="nxml-attribute-local-name">content-type</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">application/x-www-form-urlencoded</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
               <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">for-each</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">goog:auth-params($email, $pwd)</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
                  <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">value-of</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">@name</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
                  <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">text</span><span class="nxml-tag-delimiter">&gt;</span><span class="nxml-text">=</span><span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">text</span><span class="nxml-tag-delimiter">&gt;</span>
                  <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">value-of</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">encode-for-uri(.)</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
                  <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">if</span> <span class="nxml-attribute-local-name">test</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">position() ne last()</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
                     <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">text</span><span class="nxml-tag-delimiter">&gt;</span><span class="nxml-entity-ref-delimiter">&amp;</span><span class="nxml-entity-ref-name">amp</span><span class="nxml-entity-ref-delimiter">;</span><span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">text</span><span class="nxml-tag-delimiter">&gt;</span>
                  <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">if</span><span class="nxml-tag-delimiter">&gt;</span>
               <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">for-each</span><span class="nxml-tag-delimiter">&gt;</span>
            <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">http</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">body</span><span class="nxml-tag-delimiter">&gt;</span>
         <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">http</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">request</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">variable</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> send the request and get the response </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">variable</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">response</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">http-java:send-request($request)</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> was the request ok? </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">sequence</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">goog:check-error($response[1], 'Error while login')</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> get the auth token in the response </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">sequence</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">
          substring-after(
            tokenize($response[2], '</span><span class="nxml-char-ref-delimiter">&amp;#</span><span class="nxml-char-ref-number">10</span><span class="nxml-char-ref-delimiter">;</span><span class="nxml-attribute-value">')
              [substring-before(., '=') eq 'Auth'],
            '=')</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">function</span><span class="nxml-tag-delimiter">&gt;</span>

   <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content">
       Get a simple feed content.
       
       Send to the right endpoint (regarding the feed), a simple HTTP
       GET, with the right HTTP header for authorization (defined by
       Google).  Then check the response, and if everything was ok,
       parse the XML result.
   </span><span class="nxml-comment-delimiter">--&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">function</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">goog:get-feed</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">element()</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the authentication token </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">auth</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the feed name </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">param</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">feed</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the endpoint </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">variable</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">endpoint</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">xs:string</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">
          concat('https://www.google.com/m8/feeds/',
                 $feed,
                 '/default/full?max-results=1000')</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the http request element </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">variable</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">request</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">as</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">element()</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
         <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">http</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">request</span> <span class="nxml-attribute-local-name">method</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">get</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">href</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">{ $endpoint }</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
            <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">http</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">header</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">Authorization</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">value</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">GoogleLogin auth={ $auth }</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
         <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">http</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">request</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">variable</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> send the request and get the response </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">variable</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">response</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">http-java:send-request($request)</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> was the request ok? </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">sequence</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">goog:check-error($response[1], 'Error while getting groups')</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> get the response as an xml element </span><span class="nxml-comment-delimiter">--&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">sequence</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">$response[2]/*</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">function</span><span class="nxml-tag-delimiter">&gt;</span>

   <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content">
       Main template: authenticates, then gets contacts and groups.
   </span><span class="nxml-comment-delimiter">--&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">template</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">main</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-local-name">contacts-and-groups</span><span class="nxml-tag-delimiter">&gt;</span>
         <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the authentication token </span><span class="nxml-comment-delimiter">--&gt;</span>
         <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">variable</span> <span class="nxml-attribute-local-name">name</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">auth</span><span class="nxml-attribute-value-delimiter">"</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">goog:auth-token($account, $pwd)</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
         <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the contacts </span><span class="nxml-comment-delimiter">--&gt;</span>
         <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">sequence</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">goog:get-feed($auth, 'contacts')</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
         <span class="nxml-comment-delimiter">&lt;!--</span><span class="nxml-comment-content"> the groups </span><span class="nxml-comment-delimiter">--&gt;</span>
         <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">sequence</span> <span class="nxml-attribute-local-name">select</span>=<span class="nxml-attribute-value-delimiter">"</span><span class="nxml-attribute-value">goog:get-feed($auth, 'groups')</span><span class="nxml-attribute-value-delimiter">"</span><span class="nxml-tag-slash">/</span><span class="nxml-tag-delimiter">&gt;</span>
      <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-local-name">contacts-and-groups</span><span class="nxml-tag-delimiter">&gt;</span>
   <span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">template</span><span class="nxml-tag-delimiter">&gt;</span>

<span class="nxml-tag-delimiter">&lt;</span><span class="nxml-tag-slash">/</span><span class="nxml-element-prefix">xsl</span><span class="nxml-element-colon">:</span><span class="nxml-element-local-name">stylesheet</span><span class="nxml-tag-delimiter">&gt;</span>
</pre>
